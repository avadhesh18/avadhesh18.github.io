<!DOCTYPE html>
 <html><head><title>Reddit mobile web viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<meta charset="utf8">
<link rel="stylesheet" href="styles.css"  type="text/css"/>
</head>
<body>
<div id="header">
<div id="pagetitle" >
<span id="plus" onclick="toggle('leftbar')" >+</span>
<span id="pagetitletext" onclick="toggle('subssearch')">Home </span>
<span id="menu" onclick="toggle('rightbar')" ><span class="menubars">Menu</span></span>
</div></div>
<div id="menus">
<div id="subssearch" class="hidden">
<input type="text" id="subssearchi" name="qury" onkeyup="searchsubs(this.value,event)" autocomplete="off"/>
<div id="subslist"></div>

</div>
<div id="leftbar" class="hidden">
<div class="list">
<a href="home.html" class="homelinks">Home</a>
<a href="subreddit.htm?r=alll" class="homelinks">All</a>
<div id="subscribed"></div>
<div id="cthemew"><a onclick="toggletheme('dark')" id="themebtn">Dark mode</a></div>
</div>
</div>
<div id="rightbar" class="hidden"></div>

<div id="body">
</div>

<script src="functions.js"></script>
<script>

 
//Loading of posts
 
function doit(){
if(JSON.parse(localStorage.getItem("subs")) !== null){
subslisted = ''; subslistedarray = JSON.parse(localStorage.getItem("subs"));
for(x in subslistedarray){
subslisted += '<a href="?subreddit,html?r='+subslistedarray[x]+'" class="homelinks">'+subslistedarray[x]+'</a>';
}
document.getElementById('subscribed').innerHTML = subslisted;
}

function getget(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}



links = '<a href="subreddit.html?r='+getget('r')+'&sort=new">New</a><a href="subreddit.html?r='+getget('r')+'&sort=best">Best</a><a href="subreddit.html?r='+getget('r')+'&sort=rising">Rising</a><a href="subreddit.html?r='+getget('r')+'&sort=top">Top</a><a href="subreddit.html?r='+getget('r')+'&sort=top&t=month">Top (month)</a><a href="subreddit.html?r='+getget('r')+'&sort=top&t=all">Top (all)</a>';
if(checklc('subs',getget('r'))){
links += '<a onclick="unsubscribe(\''+getget('r')+'\')" id="subbtn">Unsubscribe</a>';
}
else {
links += '<a onclick="subscribe(\''+getget('r')+'\')" id="subbtn">Subscribe</a>';
}

document.getElementById('rightbar').innerHTML = links;
var fill = '';
/*
url = getget('url');
url = url.replace(/amp.reddit.com/g, 'www.reddit.com');
url = url.replace(/m.reddit.com/g, 'www.reddit.com');
url = url.replace(/i.reddit.com/g, 'www.reddit.com');
*/

substoload = getget('r');
document.getElementById('pagetitletext').innerHTML = getget('r');


url='https://www.reddit.com/r/'+substoload+'/';
if(getget('sort') != null){
url = url+''+getget('sort')+'';
}


console.log(url);
url = url+'.json?limit=20';
if(getget('t') != null){
console.log(getget('t'));
url = url+'&t='+getget('t');
}

if(getget('after') != null){
url = url+'&after='+getget('after');
}
if(getget('before') != null){
url = url+'&before='+getget('before');
}

var req = new XMLHttpRequest();
req.responseType = 'json';
req.open('GET', url, true);
req.onload  = function() {
var jsonResponse = req.response;
 

var titlesx = url.replace("https://www.reddit.com/r/", "");
titlesx = titlesx.replace("/.json", "");
document.title = titlesx;
posts = jsonResponse['data']['children'];


for(var item in posts) {
console.log("xx" + item);
pid =  posts[item]['data'];
fill += postbuilder(pid);
}
fill += '<div class="navigate">';
var curpage = window.location.href.replace(/\&after.*/,'');
if(jsonResponse['data']['after'] != null) {
fill += '<a class="next" href="'+curpage+'&after='+jsonResponse['data']['after']+'">Next page</a>'
}
fill += '</div>';
document.getElementById('body').innerHTML = fill;
  
};
req.send(null);
}


doit();
</script>
</style>
</body></html>
